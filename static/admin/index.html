<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ybigta Content Admin page</title>
  </head>
  <body>
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
    <script src="https://unpkg.com/browse/netlify-cms-media-library-cloudinary@1.3.10/dist/netlify-cms-media-library-cloudinary.js"></script>
    <script>
      function parseYoutubeVideoId(url) {
        const regExp =
          /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#&?]*).*/;
        const match = url.match(regExp);
        return match && match[2].length === 11 ? match[2] : null;
      }

      const YoutubeEmbedEditor = {
        id: "youtube-video",
        label: "Embed Youtube",
        fields: [
          {
            name: "link",
            label: "유튜브 동영상 링크",
            widget: "string",
          },
        ],
        pattern:
          /```mdx-code-block.*\n*.*[\s]*<ReactPlayer.*url="(.*?)".*\/>.*\n.*```/ms,
        fromBlock: function (match) {
          return {
            link: match[1],
          };
        },
        toBlock: function (data) {
          return `\`\`\`mdx-code-block\nimport ReactPlayer from 'react-player';\n<ReactPlayer url="${data.link}" />\n\`\`\``;
        },
        toPreview: function (data) {
          const videoId = parseYoutubeVideoId(data.link);
          console.log(videoId);
          return `
            <div style="width: 100%; max-width: 640px; height:360px;" >
              <iframe
                frameborder="0"
                allowfullscreen="1"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                width="100%"
                height="100%"
                src="https://www.youtube.com/embed/${videoId}?autoplay=0&amp;mute=0&amp;controls=0&amp;origin=http%3A%2F%2Flocalhost%3A3000&amp;playsinline=1&amp;showinfo=0&amp;rel=0&amp;iv_load_policy=3&amp;modestbranding=1&amp;enablejsapi=1&amp;widgetid=1"
                id="widget2"
              ></iframe>
            </div>
            `;
        },
      };
    </script>
    <script>
      CMS.registerEditorComponent(YoutubeEmbedEditor);
      // CMS.registerLocale("ko", ko);

      CMS.registerMediaLibrary(cloudinary);
      CMS.registerPreviewStyle("./preview.css");

      // Initialize the CMS object
      CMS.init();
    </script>
  </body>
</html>
